
# BEGIN WordPress
# The directives (lines) between "BEGIN WordPress" and "END WordPress" are
# dynamically generated, and should only be modified via WordPress filters.
# Any changes to the directives between these markers will be overwritten.
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]
RewriteBase /
RewriteRule ^index\.php$ - [L]
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L]
</IfModule>

# ----------------------------------------------------------------------
# 1. SICUREZZA: Forzare HTTPS
# ----------------------------------------------------------------------
# Reindirizza tutto il traffico su connessione sicura
RewriteEngine On
RewriteCond %{HTTPS} off
RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# ----------------------------------------------------------------------
# 2. SICUREZZA: Nascondere la lista file
# ----------------------------------------------------------------------
# Impedisce ai curiosi di vedere l'elenco dei file se digitano una cartella
Options -Indexes

# ----------------------------------------------------------------------
# 3. PERFORMANCE: Compressione GZIP
# ----------------------------------------------------------------------
# Comprime i file prima di inviarli al browser (riduce il peso fino al 70%)
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# ----------------------------------------------------------------------
# 4. PERFORMANCE: Browser Caching (La parte più importante)
# ----------------------------------------------------------------------
# Dice al browser di salvare immagini e CSS nella memoria locale
# così l'utente li scarica solo la prima volta.
<IfModule mod_expires.c>
  ExpiresActive On
  
  # Le immagini restano in cache per 1 anno
  ExpiresByType image/jpg "access plus 1 year"
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/webp "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  
  # CSS e JS restano in cache per 1 mese
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType application/javascript "access plus 1 month"
  
  # Favicon
  ExpiresByType image/x-icon "access plus 1 year"
</IfModule>


# ----------------------------------------------------------------------
# 5. SICUREZZA: Protezione Hotlink (Anti-Furto Immagini)
# ----------------------------------------------------------------------
# Blocca i siti esterni che cercano di caricare le tue immagini
RewriteEngine on
RewriteCond %{HTTP_REFERER} !^$
RewriteCond %{HTTP_REFERER} !^http(s)?://(www\.)?elton-brahja.great-site.net [NC]
RewriteCond %{HTTP_REFERER} !^http(s)?://(www\.)?google.com [NC]
RewriteCond %{HTTP_REFERER} !^http(s)?://(www\.)?bing.com [NC]
RewriteCond %{HTTP_REFERER} !^http(s)?://(www\.)?yahoo.com [NC]
RewriteRule \.(jpg|jpeg|png|gif|webp|svg)$ - [NC,F,L]

# END WordPress